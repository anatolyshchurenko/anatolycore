// made by mr.chronica 

// ============================================================================
// ОБРАБОТЧИК ФОРМЫ РЕГИСТРАЦИИ
// ============================================================================

// Добавляем обработчик события submit для формы регистрации
// Когда пользователь отправляет форму, вызывается функция registrationFunc
document.getElementById('regist_form').addEventListener('submit', registrationFunc);

// ============================================================================
// ФУНКЦИИ ДЛЯ УПРАВЛЕНИЯ ВСПЛЫВАЮЩИМИ ОКНАМИ
// ============================================================================

/**
 * Функция для показа/скрытия информационного блока о сайте
 * Вызывается при клике на кнопку "Инфо" в шапке
 */
function infoButton() {
    // Получаем элемент с информацией о сайте
    const element = document.getElementById("h_info");
    
    // Проверяем текущее состояние элемента:
    // - Если opacity равно "0" или не установлено (пустая строка)
    // - То показываем элемент (opacity = "1")
    // - Иначе скрываем (opacity = "0")
    if (element.style.opacity == "0" || element.style.opacity == "") {
        element.style.opacity = "1";  // Показать элемент
    } else {
        element.style.opacity = "0";  // Скрыть элемент
    }
}

/**
 * Функция для показа/скрытия блока информации об авторе
 * Вызывается при клике на кнопку "Автор" в шапке
 */
function authorButton() {
    // Получаем элемент с информацией об авторе
    const element = document.getElementById("h_author");
    
    // Та же логика переключения видимости, что и в infoButton()
    if (element.style.opacity == "0" || element.style.opacity == "") {
        element.style.opacity = "1";  // Показать элемент
    } else {
        element.style.opacity = "0";  // Скрыть элемент
    }
}

// ============================================================================
// ФУНКЦИЯ РЕГИСТРАЦИИ ПОЛЬЗОВАТЕЛЯ
// ============================================================================

/**
 * Основная функция обработки регистрации пользователя
 * Выполняет валидацию данных и логирование успешной регистрации
 * 
 * @param {Event} event - Событие submit формы
 * @returns {boolean} - Всегда возвращает false для предотвращения отправки формы
 */
function registrationFunc(event) {
    // Предотвращаем стандартное поведение формы (перезагрузку страницы)
    event.preventDefault();
    
    // Получаем элемент формы регистрации
    var el = document.getElementById('regist_form');
    
    // Логируем начало процесса регистрации (для отладки)
    console.log("Начало регистрации пользователя");
    
    // ========================================================================
    // ПОЛУЧЕНИЕ ДАННЫХ ИЗ ФОРМЫ
    // ========================================================================
    
    // Получаем и очищаем значения из полей формы:
    // - trim() удаляет лишние пробелы в начале и конце строки
    
    // Имя пользователя (логин)
    var name = el.name.value.trim();
    
    // Пароль (без trim, так как пробелы в пароле могут быть значимы)
    var password = el.password.value;
    
    // Email адрес
    var email = el.email.value.trim();
    
    // Переменная для хранения сообщений об ошибках
    var failReg = "";
    
    // ========================================================================
    // ВАЛИДАЦИЯ ДАННЫХ
    // ========================================================================
    
    // Проверка 1: Все поля должны быть заполнены
    if (name == "" || password == "" || email == "") {
        failReg = "Заполните все поля";
    }
    // Проверка 2: Длина имени (3-15 символов)
    else if (name.length <= 3) {
        failReg = "Имя должно быть больше 3-х символов";
    }
    else if (name.length > 15) {
        failReg = "Имя должно быть не больше 15-ти символов";
    }
    
    /**
     * Вспомогательная функция для валидации email
     * Использует регулярное выражение для проверки формата email
     * 
     * @param {string} email - Email для проверки
     * @returns {boolean} - true если email валиден, false если нет
     */
    function validateEmail(email) {
        // Регулярное выражение для проверки email:
        // - Должен содержать символы до @
        // - Должен содержать @
        // - Должен содержать домен после @
        // - Должен содержать точку в доменной части
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
    }
    
    // Проверка 3: Валидность email (только если предыдущие проверки прошли)
    if (failReg == "" && !validateEmail(email)) {
        failReg = "Введите корректный email";
    }
    
    // ========================================================================
    // ОБРАБОТКА ОШИБОК ВАЛИДАЦИИ
    // ========================================================================
    
    // Если есть ошибки валидации:
    if (failReg !== "") {
        // Показываем сообщение об ошибке пользователю
        alert(failReg);
        
        // Логируем ошибку для отладки
        console.log("Регистрация не удалась: " + failReg);
        
        // Прерываем выполнение функции
        return false;
    }
    
    // ========================================================================
    // УСПЕШНАЯ РЕГИСТРАЦИЯ
    // ========================================================================
    
    // Логирование успешной регистрации
    console.log("=== РЕГИСТРАЦИЯ УСПЕШНА ===");
    console.log("name: " + name);
    console.log("email: " + email);
    
    // Безопасное логирование пароля (маскируем большую часть)
    // Скрываем первые пять символов пароля *
    console.log("password: " + "*****" + password.substring(3));
    console.log("===========================");
    
    // Уведомляем пользователя об успешной регистрации
    alert("Регистрация пользователя прошла успешно");
    
    // ========================================================================
    // ДОПОЛНИТЕЛЬНЫЕ ДЕЙСТВИЯ (ЗАКОММЕНТИРОВАНЫ)
    // ========================================================================
    
    // Здесь мог бы быть код для отправки данных на сервер:
    // sendToServer(name, email, password);
    
    // Возвращаем false для предотвращения отправки формы
    // (данные остаются на клиенте, отправка на сервер не происходит)
    return false;
}

// ============================================================================
// ПРИМЕЧАНИЯ ДЛЯ РАЗРАБОТЧИКА:
// ============================================================================
// 
// 1. БЕЗОПАСНОСТЬ:
//    - Пароль логируется в маскированном виде (только для отладки)
//    - В реальном приложении НЕЛЬЗЯ логировать пароли
//    - Данные не отправляются на сервер (закомментирован sendToServer)
//
// 2. УЛУЧШЕНИЯ, КОТОРЫЕ МОЖНО ДОБАВИТЬ:
//    - Сохранение данных в localStorage/sessionStorage
//    - Отправка данных на сервер через fetch/XMLHttpRequest
//    - Показ ошибок не через alert, а в интерфейсе
//    - Валидация сложности пароля
//    - Подтверждение email
//
// 3. ТЕКУЩАЯ ФУНКЦИОНАЛЬНОСТЬ:
//    - Валидация обязательных полей
//    - Проверка длины имени
//    - Валидация формата email
//    - Логирование для отладки
//    - Визуальная обратная связь через alert
//
// ============================================================================